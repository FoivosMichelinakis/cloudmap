#!/usr/bin/python
# -*- coding: utf-8 -*-

import os
import shutil
import re
import errno
import time
import json



# default parameters
nodeId = "0"
# targets =  ["lh3.googleusercontent.com", "fonts.gstatic.com", "www.gstatic.com", "b.scorecardresearch.com", "s3.amazonaws.com", "pbs.twimg.com", "device-api.urbanairship.com", "z.moatads.com", "static.xx.fbcdn.net", "sb.scorecardresearch.com", "lh5.googleusercontent.com", "s.ytimg.com", "lh6.googleusercontent.com", "external.xx.fbcdn.net", "connect.facebook.net", "scontent.xx.fbcdn.net", "px.moatads.com", "bs.serving-sys.com", "platform.twitter.com", "pic.babybus.org", "combine.urbanairship.com", "lh4.googleusercontent.com", "assets.adobedtm.com", "cdn.optimizely.com", "i.ytimg.com", "a.applovin.com", "api.vungle.com", "img.applovin.com", "storage.googleapis.com", "staticxx.facebook.com", "lh4.ggpht.com", "lh3.ggpht.com", "d.applovin.com", "c.betrad.com", "lh5.ggpht.com", "d3v1lb83psg9di.cloudfront.net", "images-na.ssl-images-amazon.com", "cdnjs.cloudflare.com", "i.imgur.com", "s.yimg.com", "vid.applovin.com", "api.accuweather.com", "aax-us-east.amazon-adsystem.com", "essencedigitalna20153870852878.s.moatpixel.com", "rt.applovin.com", "encrypted-tbn2.gstatic.com", "img.youtube.com", "tags.tiqcdn.com", "cdn-highwinds.unityads.unity3d.com", "lh6.ggpht.com", "s.amazon-adsystem.com", "secure-gl.imrworldwide.com", "assets.applovin.com", "secure-ds.serving-sys.com", "pixel.quantserve.com", "cdn.manage.com", "encrypted-tbn3.gstatic.com", "cdn.liftoff.io", "mads.amazon-adsystem.com", "adrta.com", "ads.rubiconproject.com", "mobiledl.adobe.com", "choices.truste.com", "abs.twimg.com", "aax.amazon-adsystem.com", "secure.insightexpressai.com", "ton.twimg.com", "yt3.ggpht.com", "pdn.applovin.com", "vas.samsungapps.com", "optimized-by.rubiconproject.com", "inmobisdk-a.akamaihd.net", "sc.iasds01.com", "c.amazon-adsystem.com", "static.applifier.com", "cdn-lb.vungle.com", "encrypted-tbn0.gstatic.com", "secure-us.imrworldwide.com", "us-u.openx.net", "airdownload2.adobe.com", "encrypted-tbn1.gstatic.com", "mobile.pipe.aria.microsoft.com", "edge.quantserve.com", "maxcdn.bootstrapcdn.com", "gate.hockeyapp.net", "build-cdn.liftoff.io", "pixel.mathtag.com", "api.appodeal.com", "sb.voicefive.com", "cdn.taboola.com", "cf.xad.com", "widgets.outbrain.com", "www.paypalobjects.com", "fbexternal-a.akamaihd.net", "aax-eu.amazon-adsystem.com", "cdn.kidoz.net", "fbcdn-profile-a.akamaihd.net", "ua.supersonicads.com", "s3-eu-west-1.amazonaws.com", "i.l.inmobicdn.net", "supersonicads-a.akamaihd.net", "netdna.bootstrapcdn.com", "video.twimg.com", "cdn.syndication.twimg.com", "static.criteo.net", "trc.taboola.com", "pixel.rubiconproject.com", "fbstatic-a.akamaihd.net", "config.uca.cloud.unity3d.com", "images.taboola.com", "d.turn.com", "ichef.bbci.co.uk", "www.bbc.co.uk", "images.outbrain.com", "cdn.segment.com", "static.chartbeat.com", "gstatic.com", "maps.gstatic.com", "ups.ksmobile.net", "daupydqaqerlh.cloudfront.net", "u.openx.net", "cdn.doubleverify.com", "a248.e.akamai.net", "d28lrrc51wcjkk.cloudfront.net", "config2.mparticle.com", "o.twimg.com", "sa.scorecardresearch.com", "s0.wp.com", "dsum-sec.casalemedia.com", "raw.githubusercontent.com", "cds.s9s9f5n8.hwcdn.net", "p.typekit.net", "sync.search.spotxchange.com", "pixel.yabidos.com", "servedby.flashtalking.com", "www.ssacdn.com", "code.createjs.com", "aktrack.pubmatic.com", "s2.wp.com", "ad.turn.com", "ads.pubmatic.com", "ds.serving-sys.com", "media.licdn.com", "r4---sn-n4v7sn76.googlevideo.com", "dsum.casalemedia.com", "v2.chartboost.com", "use.typekit.net", "a2.chartboost.com", "2.bp.blogspot.com", "udm.scorecardresearch.com", "services.serving-sys.com", "cache.celtra.com", "scontent.fsnc1-1.fna.fbcdn.net", "tags.crwdcntrl.net", "beacon-us-iad2.rubiconproject.com", "www.redditstatic.com", "o.aolcdn.com", "tags.bkrtx.com", "ecx.images-amazon.com", "3.bp.blogspot.com", "assets.pinterest.com", "dnn506yrbagrg.cloudfront.net", "dl.google.com", "i2.cdn.turner.com", "a.disquscdn.com", "c.medialytics.com", "1.gravatar.com", "cdns.gigya.com", "r1---sn-n4v7sn7y.googlevideo.com", "cdn.cxense.com", "cdn.flashtalking.com", "cdn.arstechnica.net", "cdn3.doubleverify.com", "track.adform.net", "d5nxst8fruw4z.cloudfront.net", "secure.quantserve.com", "js.moatads.com", "jadserve.postrelease.com", "4.bp.blogspot.com", "info.static.startappservice.com"]
# executionMode = "serially"  # serially, serialPerInterface, parallel
targets = ["settings.crashlytics.com", "graph.facebook.com", "portal.fb.com", "pagead2.googlesyndication.com", "googleads.g.doubleclick.net", "www.googleapis.com", "play.googleapis.com", "pubads.g.doubleclick.net", "e.crashlytics.com", "lh3.googleusercontent.com", "www.googleadservices.com", "lh5.ggpht.com", "lh4.ggpht.com", "lh6.ggpht.com", "lh3.ggpht.com", "lh6.googleusercontent.com", "safebrowsing.googleapis.com", "www.google-analytics.com", "www.youtube.com", "lh5.googleusercontent.com", "www.facebook.com", "clients4.google.com", "cloudconfig.googleapis.com", "pagead2.googleadservices.com", "www.googletagservices.com", "tpc.googlesyndication.com", "clients3.google.com", "lh4.googleusercontent.com", "fonts.googleapis.com", "m.facebook.com", "app-measurement.com", "redirector.googlevideo.com", "play.google.com", "safebrowsing.google.com", "android.clients.google.com", "s.youtube.com", "youtubei.googleapis.com", "securepubads.g.doubleclick.net", "edge-chat.facebook.com", "fonts.gstatic.com", "www.gstatic.com", "imasdk.googleapis.com", "graph.accountkit.com", "digitalassetlinks.googleapis.com", "drive.google.com", "s.ytimg.com", "i.ytimg.com", "reminders-pa.googleapis.com", "news.google.com", "redirector.gvt1.com", "csi.gstatic.com", "ssl.gstatic.com", "docs.google.com", "androidpay-users-pa.googleapis.com", "ci5.googleusercontent.com", "www.youtube-nocookie.com", "feeds.feedburner.com", "yt3.ggpht.com", "ci6.googleusercontent.com", "www.google.com", "ci4.googleusercontent.com", "mclients.googleapis.com", "encrypted-tbn2.gstatic.com", "googleads4.g.doubleclick.net", "plus.google.com", "suggestqueries.google.com", "instantmessaging-pa.googleapis.com", "cast.google.com", "edge-star-shv-01-fra3.facebook.com", "cm.g.doubleclick.net", "scontent.xx.fbcdn.net", "translate.googleapis.com", "dl.google.com", "static.xx.fbcdn.net", "android.googleapis.com", "maps.googleapis.com", "books.google.com", "t.appsflyer.com", "partner.googleadservices.com", "s0.2mdn.net", "www.googletagmanager.com", "clients2.google.com", "encrypted-tbn1.gstatic.com", "rupload.facebook.com", "telephonyspamprotect-pa.googleapis.com", "ad.doubleclick.net", "track.appsflyer.com", "staticxx.facebook.com", "ssl.google-analytics.com", "maps.google.com", "stats.unity3d.com", "external.xx.fbcdn.net", "datasaver.googleapis.com", "apis.google.com", "encrypted-tbn3.gstatic.com", "graph.m-freeway.com", "s1.2mdn.net", "translate.google.com", "reports.crashlytics.com", "feedproxy.google.com", "fi.google.com", "clients1.google.com", "img.youtube.com", "static.doubleclick.net", "media.admob.com", "b.scorecardresearch.com", "sfo03s01-in-x02.1e100.net", "google.com", "device-api.urbanairship.com", "connect.facebook.net", "4.bp.blogspot.com", "3.bp.blogspot.com", "api.parse.com", "live.chartboost.com", "music-pa.googleapis.com", "manifest.googlevideo.com", "z.moatads.com", "androidwearcloudsync-pa.googleapis.com", "podcast.thisamericanlife.org", "cdn.xxxdessert.com", "cdn-highwinds.unityads.unity3d.com", "xxxwaffle.com", "media05.gameloft.com", "cdn.silvercartoon.com", "stats.g.doubleclick.net", "ajax.googleapis.com", "api.branch.io", "connectivitycheck.gstatic.com", "analytics.localytics.com", "nuq04s29-in-x02.1e100.net", "soma.smaato.net", "encrypted-tbn0.gstatic.com", "geo3.ggpht.com", "events3alt.adcolony.com", "v2.chartboost.com", "stats.appsflyer.com", "sb.scorecardresearch.com", "impact.applifier.com", "control.kochava.com", "payments.google.com", "myaccount.google.com", "market.android.com", "sfo03s01-in-x0a.1e100.net", "sfo07s13-in-x03.1e100.net", "px.moatads.com", "safebrowsing-cache.google.com", "mts0.google.com", "youtu.be", "events3.adcolony.com", "cdn.mdotm.com", "cdn.content.xxxwaffle.com", "assets.adobedtm.com", "scontent-sjc2-1.xx.fbcdn.net", "api.vungle.com", "taskassist-pa.googleapis.com", "accounts.google.com", "appengine.googleapis.com", "combine.urbanairship.com", "encrypted.google.com", "stats.coronalabs.com", "support.google.com", "content.googleapis.com", "plus.url.google.com", "chromecontentsuggestions-pa.googleapis.com", "cse.google.com", "lookaside.facebook.com", "api.appsflyer.com", "sfo03s06-in-x0a.1e100.net", "external-lax3-1.xx.fbcdn.net", "scontent-lax3-1.xx.fbcdn.net", "geo.moatads.com", "androidads23.adcolony.com", "appload.ingest.crittercism.com", "d3v1lb83psg9di.cloudfront.net", "api.amplitude.com", "storage.googleapis.com", "api.crittercism.com", "gcdn.2mdn.net", "androidads21.adcolony.com", "chromereader-pa.googleapis.com", "safebrowsing.googleusercontent.com", "p4-cs4i4qpoeu57w-xg4xrnm4zrswsio6-443616-s1-v6exp3-v4.metric.gstatic.com", "mail-attachment.googleusercontent.com", "m.youtube.com", "mua5.ggpht.com", "adx.g.doubleclick.net", "www.google.es", "events.appsflyer.com", "sfo07s13-in-f14.1e100.net", "ws.tapjoyads.com", "rt.applovin.com", "dpm.demdex.net", "essencedigitalna20153870852878.s.moatpixel.com", "nuq04s29-in-x0a.1e100.net", "c.betrad.com", "cdn.liftoff.io", "connect.tapjoy.com", "a.applovin.com", "firebasestorage.googleapis.com", "history.google.com", "clients6.google.com", "img.applovin.com", "api.accuweather.com", "mail.google.com", "secure-ds.serving-sys.com", "www.google.be", "beacon.krxd.net", "cdn.manage.com", "cdn.optimizely.com", "trips-pa.googleapis.com", "l.betrad.com", "tools.google.com", "images-na.ssl-images-amazon.com", "www.doubleclickbygoogle.com", "gstatic.com", "d.applovin.com", "data.mistat.xiaomi.com", "clientservices.googleapis.com", "api.facebook.com", "impression.appsflyer.com", "i1.ytimg.com", "vas.samsungapps.com", "app.appsflyer.com", "scontent-lga3-1.xx.fbcdn.net", "maps-api-ssl.google.com", "scontent-frt3-1.xx.fbcdn.net", "sonar-frt.xx.fbcdn.net", "init.supersonicads.com", "i.instagram.com", "adrta.com", "i4.ytimg.com", "personalsafety-pa.googleapis.com", "external-frt3-1.xx.fbcdn.net", "external-lga3-1.xx.fbcdn.net", "feeds2.feedburner.com", "p4-cs4i4qpoeu57w-xg4xrnm4zrswsio6-443616-i1-v6exp3-ds.metric.gstatic.com", "178886.measurementapi.com", "ad.atdmt.com", "cmdts.ksmobile.com", "vid.applovin.com", "external-fra3-1.xx.fbcdn.net", "choices.truste.com", "scontent-ord1-1.xx.fbcdn.net", "wallet.google.com", "scontent-fra3-1.xx.fbcdn.net", "external-ord1-1.xx.fbcdn.net", "cdn.ampproject.org", "cdn.kidoz.net", "ipv4.google.com", "brahe.apptimize.com", "video.google.com", "mua6.ggpht.com", "config2.mparticle.com", "secure.insightexpressai.com", "scontent-iad3-1.xx.fbcdn.net", "edge-mqtt.facebook.com", "txn.ingest.crittercism.com", "profile.localytics.com", "static.applifier.com", "sfo03s01-in-f14.1e100.net", "ogs.google.com", "ua.supersonicads.com", "mobiledl.adobe.com", "pdn.applovin.com", "log.dmtry.com", "x.bidswitch.net", "scontent-dft4-2.xx.fbcdn.net", "api.uca.cloud.unity3d.com", "airdownload2.adobe.com", "www.leanplum.com", "video-ad-stats.googlesyndication.com", "config.playwire.com", "api.segment.io", "config.uca.cloud.unity3d.com", "cdn.intergi.com", "vox-static.liverail.com", "external-mia1-1.xx.fbcdn.net", "ilyonanalytics.herokuapp.com", "www.instagram.com", "cdn-adn.rayjump.com", "scontent-mia1-1.xx.fbcdn.net", "pg-in-x5f.1e100.net", "build-cdn.liftoff.io", "match.adsrvr.org", "rpc.tapjoy.com", "ilyoncp.herokuapp.com", "i.l.inmobicdn.net", "ssdk.adkmob.com", "producer.googleusercontent.com", "d-39066961691897109269.ampproject.net", "m.doubleclick.net", "sdk-api.kidoz.net", "analytics.kidoz.net", "daupydqaqerlh.cloudfront.net", "api.apptentive.com", "google-analytics.com", "mua3.googleusercontent.com", "assets.applovin.com", "d28lrrc51wcjkk.cloudfront.net", "idsync.rlcdn.com", "unconf.adkmob.com", "mua4.ggpht.com", "b-graph.facebook.com", "setting.rayjump.com", "tap-nexus.appspot.com", "ups.ksmobile.net", "choices-or.truste.com", "imap.gmail.com", "ping.chartbeat.net", "cf.xad.com", "us-notify.bidagent.xad.com", "xaapi.xamarin.com", "cdn.doubleverify.com", "newsstand.googleusercontent.com", "wsback-get-config.presage.io", "sb.voicefive.com", "sc-analytics.appspot.com", "sdk.kidoz.net", "safebrowsing.clients.google.com", "manifest.localytics.com", "www.google.co.in", "net.rayjump.com", "developers.google.com", "cdn.segment.com", "scontent-cdg2-1.xx.fbcdn.net", "186232.engine.mobileapptracking.com", "external-dfw1-1.xx.fbcdn.net", "b-www.facebook.com", "cds.n9c4n8x5.hwcdn.net", "external-cdg2-1.xx.fbcdn.net", "e-ltvp.inmobi.com", "connectivitycheck.android.com", "z-m-graph.facebook.com", "d.agkn.com", "economy.covetfashion.com", "scontent-dfw1-1.xx.fbcdn.net", "www.ssacdn.com", "b-api.facebook.com", "external-dfw.xx.fbcdn.net", "inmobisdk-a.akamaihd.net", "outcome.supersonicads.com", "tags.tagcade.com", "i3.ytimg.com", "xtra3.gpsonextra.net", "cache.agilebits.com", "bid.g.doubleclick.net", "avg-hrd.appspot.com", "d.appsdt.com", "ads.rubiconproject.com", "www.google.de", "cdn.arstechnica.net", "txn.ingest.eu.crittercism.com", "supersonicads-a.akamaihd.net", "i2.ytimg.com", "178132.measurementapi.com", "platform.instagram.com", "up.cm.ksmobile.com", "md-a-s.apptimize.com", "helpnewsrepublic1.ksmobile.com", "1365.engine.mobileapptracking.com", "www.paypalobjects.com", "e.apsalar.com", "log.applifier.com", "geo2.ggpht.com", "1681.engine.mobileapptracking.com", "graph.instagram.com", "scontent-lax3-1.cdninstagram.com", "ec2-54-154-161-133.eu-west-1.compute.amazonaws.com", "t2.chartboost.com", "pixel.moatads.com", "scontent.cdninstagram.com", "events.mobile.optimizely.com", "stat.flashtalking.com", "gdb.vascogames.com", "scontent-atl3-1.xx.fbcdn.net", "md-a-c.apptimize.com", "ichef.bbci.co.uk", "a2.chartboost.com", "rtd.tubemogul.com", "cdn-lb.vungle.com", "logger.instagram.com", "mads.vascogames.com", "androidha.vascogames.com", "2941656.fls.doubleclick.net", "scontent-ort2-1.xx.fbcdn.net", "rv-gateway.supersonicads.com", "external-ort2-1.xx.fbcdn.net", "scontent-dft4-1.xx.fbcdn.net", "dl.cm.ksmobile.com", "hooks.helpshift.com", "trc.taboola.com", "images.taboola.com", "ms.cmcm.com", "api.wunderground.com", "notify.bugsnag.com", "apm.crittercism.com", "mobile.adsafeprotected.com", "api.weather.com", "p.adsymptotic.com", "goo.gl", "d-17759600003417462073.ampproject.net", "placements.tapjoy.com", "servedby.flashtalking.com", "sync.tidaltv.com", "services.serving-sys.com", "helpkewl0.ksmobile.com", "pixel.mathtag.com", "img1.store.ksmobile.net", "global.ymtracking.com", "sig.atdmt.com", "code.createjs.com", "tags.tiqcdn.com", "v4.moatads.com", "a248.e.akamai.net", "mindjolt-a.akamaihd.net", "supersonic.ironbeast.io", "nexus.ensighten.com", "www.google.ca", "xtrapath1.izatcloud.net", "57e83ca9.api.splkmobile.com", "cdn.spotxcdn.com", "a.mologiq.net", "s.thebrighttag.com", "cognito-identity.us-east-1.amazonaws.com", "id.google.com.ar", "supercell.helpshift.com", "xtrapath2.izatcloud.net", "sports-tracker.helpshift.com", "static.ssacdn.com", "widgets.outbrain.com", "d3publisher.helpshift.com", "helpcmlite1.ksmobile.com", "ord30s26-in-f238.1e100.net", "ads.admarvel.com", "ticks2.bugsense.com", "track.celtra.com", "admin.appnext.com", "instagram.com", "mop2-24-funatthefarmlite.appspot.com", "p.a4.tl", "external-atl3-1.xx.fbcdn.net", "external-dft4-1.xx.fbcdn.net", "appodeal.bidsopt.com", "api.kiip.me", "med.heyzap.com", "images.outbrain.com", "mqtt-mini.facebook.com", "e.nexac.com", "ws.ksmobile.net", "orionimg.adkmob.com", "graph2.facebook.com", "ads-sg-aws.adsymptotic.com", "dsum-sec.casalemedia.com", "mop2-26-birdspuzzlelite.appspot.com", "skslm.swiftkey.net", "d.adroll.com", "helpwhitetile21.ksmobile.com", "appload.ingest.eu.crittercism.com", "api.ad4push.com", "c.amazon-adsystem.com", "www.cm.ksmobile.com", "switch.atdmt.com", "d1ovo20x1yw5yz.cloudfront.net", "maps.gstatic.com", "plusone.google.com", "omax.admarvel.com", "partners.tremorhub.com", "alt6-mtalk.google.com", "muscle.moov.cc", "helpcmstk0.ksmobile.com", "view.atdmt.com", "d30x8mtr3hjnzo.cloudfront.net", "xtrapath3.izatcloud.net", "c.medialytics.com", "geo-prism.htcsense.com", "android-quinoa-config-prod.sense360eng.com", "cache.celtra.com", "23362.engine.mobileapptracking.com", "ec2-52-35-7-64.us-west-2.compute.amazonaws.com", "aktrack.pubmatic.com", "cache.mindjolt.com", "resolver.msg.xiaomi.net", "ci3.googleusercontent.com", "ads.celtra.com", "ecx.images-amazon.com", "mtalk.google.com", "cdn.taboola.com", "ebd7ff60.api.splkmobile.com", "sync.adaptv.advertising.com", "cdn.hiberniacdn.com", "ord36s04-in-x0e.1e100.net", "gdata.youtube.com", "mtalk4.google.com", "apiv2.moengage.com", "img.serveroute.com", "api.appnimator.com", "invenio_tracking_h.sgnapps.com", "tracking.lenzmx.com", "polling.bbc.co.uk", "goappdl.goforandroid.com", "appengage-video.sponsorpay.com", "mua3.ggpht.com", "xtra2.gpsonextra.net", "sync.adap.tv", "resolver.gslb.mi-idc.com", "ord36s02-in-x01.1e100.net", "gizmo-s.serving-sys.com", "cdn3.doubleverify.com", "cdn.cxense.com", "track.56txs4.com", "hkg12s09-in-f14.1e100.net", "inbox.google.com", "au.ff.avast.com", "helpcmqp0.ksmobile.com", "cdn1.inner-active.mobi", "avg-cs.appspot.com", "www.zara.com", "gs.mindjolt.com", "5876443.fls.doubleclick.net", "servicios.atresplayer.com", "d2ym6yrl197shi.cloudfront.net", "b0693e5d.api.splkmobile.com", "clk.taptica.com", "12694.engine.mobileapptracking.com", "www.supersonicads.com", "home.htcsense.com", "s-cdn-tag.medialytics.com", "invenio.sgn.com", "www.google.ch", "invenio_tracking_l.sgnapps.com", "ml314.com", "tr.pubnative.net", "i0.wp.com", "bcp.crwdcntrl.net", "alt5-mtalk.google.com", "m.media-amazon.com", "static.massimodutti.net", "init.startappexchange.com", "boxerupgrades.getboxer.com", "api.placed.com", "narrative.android.pocketgems.com", "js.moatads.com", "sdk.hockeyapp.net", "alt2-mtalk.google.com", "www.uterque.com", "fbcdn-profile-a.akamaihd.net", "finance.google.com", "3812387.fls.doubleclick.net", "d37gvrvc0wt4s1.cloudfront.net", "ota.cloudfront.lookout.com", "cd.aviary.com", "fbexternal-a.akamaihd.net", "d1lqe9temigv1p.cloudfront.net", "www.massimodutti.com", "ord36s02-in-x0a.1e100.net", "in.cuebiq.com", "feed.thisamericanlife.org", "3877730.fls.doubleclick.net", "analytics.rayjump.com", "magnetic.t.domdex.com", "mobile.facebook.com", "scontent-lga3-1.cdninstagram.com", "i1.wp.com", "t.singular.net", "static.uterque.net", "api-m.paypal.com", "cx.atdmt.com", "cache.btrll.com", "www.zarahome.com", "ad.360yield.com", "i2.wp.com", "ssp.lkqd.net", "api.gameanalytics.com", "1199.engine.mobileapptracking.com", "4233693.fls.doubleclick.net", "consumer.exacttargetapis.com", "www.serveroute.com", "trk.glispa.com", "sync.ipredictive.com", "android.api.gimbal.com", "ads.pubmatic.com", "recommend-prism.htcsense.com", "tap2-cdn.rubiconproject.com", "nexus-websocket-b.intercom.io", "ib.isappcloud.com", "edge-chat.p.facebook.com", "dm.htcsense.com", "s.adroll.com", "pubsub.pubnub.com", "ads.heyzap.com", "media.licdn.com", "mars.tnt-ea.com", "invenio_tracking_b.sgnapps.com", "p.univide.com", "z-1-scontent.xx.fbcdn.net", "167154.engine.mobileapptracking.com", "detour.helpshift.com", "alt3-mtalk.google.com", "d3ohh9b4v3oawh.cloudfront.net", "mobilemaps.clients.google.com", "cm.gcm.ksmobile.com", "i.tapsense.com", "ord31s22-in-f238.1e100.net", "log.pinterest.com", "op-ue.storage.googleapis.com", "tgappfarmpuzzle.appspot.com", "ads.superawesome.tv", "a.fiksu.com", "ads04.tapsense.com", "js.dmtry.com", "stage-vid.applovin.com", "ag.innovid.com", "ps.eyeota.net", "pegasus.cmcm.com", "ord31s22-in-x0a.1e100.net", "androidquery.appspot.com", "csbi.htcsense.com", "content.cdn.viber.com", "dh.serving-sys.com", "bj-dsponline-virginia-1763182688.us-east-1.elb.amazonaws.com", "ord30s21-in-x0a.1e100.net", "s-cdn-creative.medialytics.com", "auth.gfx.ms", "fs.smartstudy.co.kr", "go.microsoft.com", "cdn2.inner-active.mobi", "click.startappservice.com", "assets.pinterest.com", "nativesdks.mparticle.com", "doc-0s-44-docs.googleusercontent.com", "syn-dir.sn.eamobile.com", "scontent-lax3-2.xx.fbcdn.net", "openmobiledata.appspot.com", "static.bbci.co.uk", "invenio_tracking_a.sgnapps.com", "d710607a.api.splkmobile.com", "fra15s18-in-f14.1e100.net", "aptrk.com", "sp.auth.adobe.com", "adcel.vrvm.com", "cr.m.ksmobile.net", "www.ultraadserver.com", "sdk.api.xtify.com", "apkquery.ksmobile.net", "web.facebook.com", "alt8-mtalk.google.com", "business-calendar-weather.appspot.com", "or-se.storage.googleapis.com", "ord30s25-in-x0a.1e100.net", "wordswithfriends.zyngawithfriends.com", "androidads20.adcolony.com", "vortex.accuweather.com", "d4saq4zdjnf1a.cloudfront.net", "cls.vrvm.com", "dnn506yrbagrg.cloudfront.net", "tags.bkrtx.com", "internal-newsstand-sandbox.googleusercontent.com", "static.parsely.com", "config-ltvp.inmobi.com", "ds.serving-sys.com", "event.inner-active.mobi", "i.w55c.net", "159126.engine.mobileapptracking.com", "189732.engine.mobileapptracking.com", "odr.mookie1.com", "app.snapchat.com", "fbstatic-a.akamaihd.net", "adproxy.fyber.com", "secure.cdn.fastclick.net", "photo-gallery.mobileposse.com", "cdns.amgdgt.com", "service.maxymiser.net", "media3.giphy.com", "mobile-api.ifttt.com", "go.vrvm.com", "media.giphy.com", "nexus-websocket-a.intercom.io", "2712.content.swrve.com", "e.visualdna.com", "mp-content-app-photo-gallery.mobileposse.com", "mop2-20-zoopuzzlelite.appspot.com", "imgcdn-aka2.newsrep.net", "clicks.minimob.com", "pgdemilovato.appspot.com", "media2.giphy.com", "www.startappexchange.com", "tgappinsectspuzzle.appspot.com", "cdn.adnxs.com", "sdkconfig.ad.xiaomi.com", "td-click-haproxy.supersonicads.com", "pc-in-x9a.1e100.net", "d1pvdv1exgrgzw.cloudfront.net", "bidagent.xad.com", "nexonm.helpshift.com", "appfly.mobi", "de01.rayjump.com", "clients5.google.com", "m2m1.inner-active.mobi", "static.licdn.com", "z-1-external.xx.fbcdn.net", "alt7-mtalk.google.com", "weather.ksmobile.com", "eb2.3lift.com", "video.fyber.com", "cr.m.ksmobile.com", "imps.appia.com", "dailymotion-mobile-compute.appspot.com", "appclick.co", "mad06s10-in-f6.1e100.net", "sta.yabidos.com", "cdn.adrta.com", "collector.schibsted.io", "itunes.apple.com", "secure.flashtalking.com", "d8rk54i4mohrb.cloudfront.net", "cb.ksmobile.com", "moto-cds.appspot.com", "tag.researchnow.com", "a.adroll.com", "everyplay.com", "cis.schibsted.com", "www.google.fr", "rpxnow.com", "pixeltrack.eyeviewads.com", "cdns.gigya.com", "bp.adkmob.com", "f.aduwant.com", "t2.gstatic.com", "service.supercell.net", "ds-aksb-a.akamaihd.net", "gmtdmp.mookie1.com", "cleaner.mobile.tools.avast.com", "tgappdinomathschool.appspot.com", "mpp.vindicosuite.com", "www.npr.org", "acompli.helpshift.com", "alt1-mtalk.google.com", "weather.ksmobile.net", "router-a0-push.leancloud.cn", "textsecure-service.whispersystems.org", "ord31s22-in-x0e.1e100.net", "track.eyeviewads.com", "189358.engine.mobileapptracking.com", "www.google.ee", "m.jcpenney.com", "api.zynga.com", "lb-www6.mdotm.com", "ord36s04-in-x0a.1e100.net", "socialize.us1.gigya.com", "sdk.fiksu.com", "g-ecx.images-amazon.com", "2712.api.swrve.com", "open.oneplus.net", "forqan-edu-tech.com", "3785.api.swrve.com", "img1.blogblog.com", "cdn.smartstudy.co.kr", "render.bitstrips.com", "mop2-21-seapuzzlelite.appspot.com", "us-east-1.pm-notifications.com", "img-prism.htcsense.com", "user.sn.eamobile.com", "ad.adsrvr.org", "river-mobile.data.ea.com", "proxy.googlezip.net", "mss.handmark.com", "ud.adkmob.com", "ad.crwdcntrl.net", "conf.lyr8.net", "ec2-54-201-58-48.us-west-2.compute.amazonaws.com", "api.pubnative.net", "ce-global-track-prod-1119723899.ap-northeast-1.elb.amazonaws.com", "tgappbirdspuzzle.appspot.com", "tgapprealdinosaurpuzzle.appspot.com", "3709.api.swrve.com", "push.parse.com", "ads.mdotm.com", "alt4-mtalk.google.com", "tgappzoopuzzle.appspot.com", "cdn.w55c.net", "r.nexac.com", "402.appspot.com", "as.eu.angsrvr.com", "v1.blueberry.cloud.databerries.com", "tgappseapuzzle.appspot.com", "rc.rlcdn.com", "homeboy.helpshift.com", "scontent-mad1-1.cdninstagram.com", "gp5.googleusercontent.com", "www-pinterest-com.cdn.ampproject.org", "dsx.weather.com", "events.aerserv.com", "1693.engine.mobileapptracking.com", "pm.w55c.net", "ads.adaptv.advertising.com", "168096.measurementapi.com", "v8.analytics.pinsightmedia.com", "s4.api.apptap.com", "gfycat.com", "qb-in-f188.1e100.net", "feelinsonice-hrd.appspot.com", "walter-producer-cdn.api.bbci.co.uk", "p.nexac.com", "ak.sail-horizon.com", "d-13318937041872239145.ampproject.net", "external-mad1-1.xx.fbcdn.net", "device.4seeresults.com", "q.adrta.com", "segments.adaptv.advertising.com", "external-amt2-1.xx.fbcdn.net", "www.trackimpression.com", "stun.l.google.com", "p.cquotient.com", "ad.api.yyapi.net", "ix-in-f95.1e100.net", "ares.agoop.net", "req.startappservice.com", "helpcleanmasterlite1.ksmobile.com", "bling2.midasplayer.com", "cloud.rovio.com", "foxnet.demdex.net", "api.leadbolt.net", "api.inmoji.com", "swiftkey-sync-production.touchtype-fluency.com", "cdn.livefyre.com", "g-ec2.images-amazon.com", "events-us-east-1.ipredictive.com", "geoinfo.intowow.com", "dlcdnamax.asus.com", "ws-superheroes.uken.com", "www.united.com", "scontent-lhr3-1.xx.fbcdn.net", "img.store.ksmobile.net", "r.casalemedia.com", "rtb2.strikead.com", "miniclip.analyzer.omniata.com", "click.apprevolve.com", "ctf.download.avg.com", "hack-app-data.appspot.com", "images-eu.ssl-images-amazon.com", "ord36s02-in-x08.1e100.net", "cdn.unityads.unity3d.com", "use.typekit.net", "product.sn.eamobile.com", "scontent-mad1-1.xx.fbcdn.net", "ichnaea.netflix.com", "s.axonix.com", "d3d87x765gtk9c.cloudfront.net", "app.qz.com", "ufs.adkmob.com", "bonuscasino.helpshift.com", "rg.appserver-ap.com", "69784.measurementapi.com", "www.paypal.com", "usa.ime.cootek.com", "privacy-wizard.firebaseio.com", "ads-au.onelouder.com", "tknet.rayjump.com", "s.w-x.co", "l.sharethis.com", "tapjoycdn-a.akamaihd.net", "s.effectivemeasure.net", "account.cyngn.com", "ord31s21-in-x0a.1e100.net", "me-cdn.effectivemeasure.net", "i2.cdn.turner.com", "pxl.jivox.com", "locker.cmcm.com", "logs-01.loggly.com", "308977.measurementapi.com", "jwpltx.com", "scontent-atl3-1.cdninstagram.com", "s.cpx.to", "www.google.co.uk", "log.agoop.net", "s-usweb.dotomi.com", "api.instagram.com", "www.washingtonpost.com", "logx.optimizely.com", "6194.eu-api.swrve.com", "scontent-iad3-1.cdninstagram.com", "cdn-settings.segment.com", "dc8xl0ndzn2cb.cloudfront.net", "gateway.ttpsdk.info", "us-api.leancloud.cn", "c.ssacdn.com", "ophan.theguardian.com", "www.fallingfalcon.com", "12846.engine.mobileapptracking.com", "msgtcp2.intsig.net", "behacdn.ksmobile.net", "jadserve.postrelease.com", "htc-club-others.htcsense.com", "accounts.doubleclick.net", "ord31s21-in-x0e.1e100.net", "external-lhr3-1.xx.fbcdn.net", "e-ssl.apsalar.com", "dispatch.im.live.ksmobile.net", "d1yprpojhqvser.cloudfront.net", "px.owneriq.net", "ets-us-east-1.smaato.net", "cdn-tags.mmondi.com", "w.sharethis.com", "socialize.eu1.gigya.com", "api.usebutton.com", "73230.measurementapi.com", "s7d9.scene7.com", "adcfg.intowow.com", "atpixelus.alephd.com", "s.ssacdn.com", "reg20.ubermedia.com", "pps.whatsapp.net", "opsen.dolphin-browser.com", "cmp-cdn.ghostery.com", "qh-in-f188.1e100.net", "s3.ttpsdk.info", "d19o643lxir6wy.cloudfront.net", "events.redditmedia.com", "reports.ubimo.com", "adconfig.infolife.mobi", "tplinkkasa.firebaseio.com", "poseidon.mobilecore.com", "track.12trackway.com", "api.flipboard.com", "a.ccdn.es", "emp.bbci.co.uk", "mobile2.24heures.ch", "apiservices.krxd.net", "smartphone.continental.com", "comments.us1.gigya.com", "vine.co", "cdn.outfit7.com", "rtb.adentifi.com", "tracker.mtrtb.com", "images.startappservice.com", "triggers.wfxtriggers.com", "mobilecrashreporting.googleapis.com", "static.bbc.co.uk", "as.casalemedia.com", "api.accengage.com", "d1e0ih91r2lgbn.cloudfront.net", "d1eth01u7tjx8a.cloudfront.net", "m2u.sn.eamobile.com", "scontent-fra3-1.cdninstagram.com", "eu2-scloud-proxy.ssp.samsungosp.com", "h.facebook.com", "s.ntv.io", "hkg07s01-in-f110.1e100.net", "jobs.jobvite.com", "pnhoiaa959.execute-api.eu-west-1.amazonaws.com", "config.rcs.mnc120.mcc310.pub.3gppnetwork.org", "hkg07s02-in-f2.1e100.net", "dsum.casalemedia.com", "z.cdn.turner.com", "mobilation.update.avg.com", "i1.sndcdn.com", "api.push.io", "udl-api.sonymobile.com", "lb1.east.ssphwy.com", "nextgames.helpshift.com", "android.revmob.com", "api.glympse.com", "services.miniclippt.com", "pn.tnt-ea.com", "contextual.media.net", "8778.engine.mobileapptracking.com", "timeline-sync.getpebble.com", "match.prod.bidr.io", "instagramstatic-a.akamaihd.net", "gallery.mailchimp.com", "www.adobe.com", "rtb.dispply.com", "ccc.sys.miui.com", "lb-im-12-2017274345.ap-southeast-1.elb.amazonaws.com", "m-superheroes.uken.com", "www.latimes.com", "tr-us.adsmoloco.com", "files.slack.com", "c.adsymptotic.com", "api-ak.wunderground.com", "lbsmob.business.tomtom.com", "static.yieldmo.com", "edge.quantserve.com", "www.20minutos.es", "horizon.businessinsider.com", "www.lyft.com", "zj.dcys.ksmobile.com", "appshelf.ttpsdk.info", "maptiles.accuweather.com", "usermatch.krxd.net", "webview.unityads.unity3d.com", "urlauth.ksmobile.net", "dbg52463.moatads.com", "h.nexac.com", "track.atom-data.io", "api.tinyhoneybee.com", "cdn.query.prod.cms.msn.com", "scontent-cdg2-1.cdninstagram.com", "haggler-doubleclick220-us-e-ec2.liftoff.io", "config.unityads.unity3d.com", "67.media.tumblr.com", "cdn.netscout.com", "argo.svcmot.com", "wd.adcolony.com", "41.media.tumblr.com", "mmg.whatsapp.net", "edge.simplereach.com", "cognito-identity.eu-west-1.amazonaws.com", "plex.tv", "sdk-configuration.gimbal.com", "295901.measurementapi.com", "1.cn.pool.ntp.org", "res.cloudinary.com", "secure.img-cdn.mediaplex.com", "d3aycj0qmmik3l.cloudfront.net", "shopvac.cyngn.com", "ssc.api.bbc.com", "ads.yieldmo.com", "swiftkey-android.iris.touchtype-fluency.com", "ec2-54-173-80-67.compute-1.amazonaws.com", "tracking.miui.com", "www.defenseone.com", "aa.agkn.com", "scontent-mia1-2.cdninstagram.com", "d30ffa3f.api.splkmobile.com", "news.bbcimg.co.uk", "careers.jobvite.com", "www.infojobs.net", "885.engine.mobileapptracking.com", "metrics.brightcove.com", "in.ml314.com", "helpcmfreecalls1.ksmobile.com", "aexp.demdex.net", "samsungresources.visionobjects.com", "metrics.sdkbox.com", "wv.inner-active.mobi", "a.vserv.mobi", "global.ib-ibi.com", "www.bkrtx.com", "img.cm.ksmobile.com", "www.google.hr", "mandrillapp.com", "creatives.revmob.com", "images3-esmobile-opensocial.googleusercontent.com", "inputtools.google.com", "api.smooch.io", "weather.ios.ijinshan.com", "content.dragonsoulgame.com", "timeinc.brightcove.com.edgesuite.net", "www.forumvs.com", "ib.mookie1.com", "ssum.casalemedia.com", "serve.vdopia.com", "drippler.helpshift.com", "7306.engine.mobileapptracking.com", "ads.glispa.com", "t.sharethis.com", "mobile-log.cmtelematics.com", "www.theatlantic.com", "info.static.startappservice.com", "s.btstatic.com", "scontent-amt2-1.xx.fbcdn.net", "gld.push.samsungosp.com", "www.theatlas.com", "d2qmdcga8xwxzj.cloudfront.net", "s2.symcb.com", "api-android.jawbone.com", "b0ff9250.api.splkmobile.com", "us-east.bidswitch.net", "dy48bnzanqw0v.cloudfront.net", "vzw.sp1.convertro.com", "ac.duckduckgo.com", "sync.teads.tv", "www.economist.com", "slack.com", "img.particlenews.com", "cc.chango.com", "dts.innovid.com", "d209qiza337ckl.cloudfront.net", "trbpub.akamaized.net", "feeds.bbci.co.uk", "tmscdn.coremetrics.com", "cdn.mxpnl.com", "s3.amazonaws.com", "pbs.twimg.com", "bs.serving-sys.com", "platform.twitter.com", "pic.babybus.org", "cdnjs.cloudflare.com", "i.imgur.com", "s.yimg.com", "aax-us-east.amazon-adsystem.com", "s.amazon-adsystem.com", "secure-gl.imrworldwide.com", "pixel.quantserve.com", "mads.amazon-adsystem.com", "abs.twimg.com", "aax.amazon-adsystem.com", "ton.twimg.com", "optimized-by.rubiconproject.com", "sc.iasds01.com", "secure-us.imrworldwide.com", "us-u.openx.net", "mobile.pipe.aria.microsoft.com", "maxcdn.bootstrapcdn.com", "gate.hockeyapp.net", "api.appodeal.com", "aax-eu.amazon-adsystem.com", "s3-eu-west-1.amazonaws.com", "netdna.bootstrapcdn.com", "video.twimg.com", "cdn.syndication.twimg.com", "static.criteo.net", "pixel.rubiconproject.com", "d.turn.com", "www.bbc.co.uk", "static.chartbeat.com", "u.openx.net", "o.twimg.com", "sa.scorecardresearch.com", "s0.wp.com", "raw.githubusercontent.com", "cds.s9s9f5n8.hwcdn.net", "p.typekit.net", "sync.search.spotxchange.com", "pixel.yabidos.com", "s2.wp.com", "ad.turn.com", "r4---sn-n4v7sn76.googlevideo.com", "2.bp.blogspot.com", "udm.scorecardresearch.com", "scontent.fsnc1-1.fna.fbcdn.net", "tags.crwdcntrl.net", "beacon-us-iad2.rubiconproject.com", "www.redditstatic.com", "o.aolcdn.com", "a.disquscdn.com", "1.gravatar.com", "r1---sn-n4v7sn7y.googlevideo.com", "cdn.flashtalking.com", "track.adform.net", "d5nxst8fruw4z.cloudfront.net", "secure.quantserve.com"]


usingDefaults = False  # in case the configurationfile is inaccessible
maxNumberOfInstances = 5
useTcpdump = "yes"
mccmnc = []  # ["22210", "21404", "21403"]
standaloneNode = "yes"
containerPause = 0

if os.path.isdir("/monroe"):
    # monroe container instance
    print "monroe container instance"
    CONFIG_FILE = '/monroe/config'
    RESULTS_DIR = "/monroe/results/"
    CURRENT_DIR = os.getcwd() + "/"
    SCRIPT_DIR = '/opt/basic_dns_tests/'
    interfaces = ["usb0", "usb1", "usb2", "op0", "op1", "op2"]
    digCommand = SCRIPT_DIR + "dig"
    typeOfNode = "Monroe"
elif (os.uname()[1] == "foivos-Latitude-E6410"):
    # testing
    print "testing"
    CONFIG_FILE = '../../supportingFiles/config'
    RESULTS_DIR = '../../supportingFiles/testingResults/'
    CURRENT_DIR = './'
    SCRIPT_DIR = './'
    interfaces = ["wlan1", "usb0"]
    digCommand = "dig"
    typeOfNode = "testing"
else:
    # wired server experiment
    print "wired server experiment"
    # the results are located in the same parent directory as the script files
    # we
    RESULTS_DIR = "/".join(os.getcwd().split("/")[:-1]) + "/results/"
    try:
        # in case the RESULTS_DIR is not present we create it
        os.makedirs(RESULTS_DIR)
    except OSError as exception:
        if exception.errno != errno.EEXIST:
            raise
    try:
        # the results of this experiment will be located at their own folder, to avoid having milliions of files  in the same place
        directoryTimestamp = str(int(time.time()))
        RESULTS_DIR = "/".join(os.getcwd().split("/")[:-1]) + "/results/" + directoryTimestamp + "/"
        os.makedirs(RESULTS_DIR)
    except OSError as exception:
        if exception.errno != errno.EEXIST:
            raise
    CONFIG_FILE = './config'
    CURRENT_DIR = os.getcwd() + "/"
    SCRIPT_DIR = './'
    interfaces = ["eth0", "eth1", "eth2"]
    digCommand = "dig"
    typeOfNode = "server"

# regular expressions
answerLine = re.compile(r'(\S+)\s*(\d+)\s*IN\s*(\S+)\s*(\S+)')
pseudosectionLine = re.compile(r'; EDNS: version: (\d+), flags:; (\S+): (\d+)')
answerSectionHeader = re.compile(r';;\s*ANSWER\s*SECTION:')


def saveResultFromString(stringToSave, filename):
    with open(CURRENT_DIR + filename, "w") as outputFile:
        outputFile.write(stringToSave)
    shutil.copy2(CURRENT_DIR + filename, RESULTS_DIR + filename + ".tmp")
    shutil.move(RESULTS_DIR + filename + ".tmp", RESULTS_DIR + filename)
    os.remove(CURRENT_DIR + filename)

def saveResultFromFile(filename):
    shutil.copy2(CURRENT_DIR + filename, RESULTS_DIR + filename + ".tmp")
    shutil.move(RESULTS_DIR + filename + ".tmp", RESULTS_DIR + filename)
    os.remove(CURRENT_DIR + filename)


def saveTopologyFile(dictTosave):
    topologyFileTimestamp = str(int(time.time()))
    intTopologyMappingFilename = "interfaceTopology_" + topologyFileTimestamp + ".json"
    intTopologyMappingFilePath = os.getcwd() + "/" + intTopologyMappingFilename
    with open(intTopologyMappingFilePath, 'wb') as fp:
        json.dump(dictTosave, fp)
    # copy the interfaceTopology file to the results
    shutil.copy2(intTopologyMappingFilePath, RESULTS_DIR + intTopologyMappingFilename + ".tmp")
    shutil.move(RESULTS_DIR + intTopologyMappingFilename + ".tmp", RESULTS_DIR + intTopologyMappingFilename)


def getServerIPs(digText):
    IPlistV4 = []
    IPlistV6 = []
    insideAnswerSection = False
    for line in str(digText).split("\n")[3:]:
        if answerSectionHeader.search(line):
            insideAnswerSection = True
        if (insideAnswerSection) and (line == ""):
            # this is the end of the answer section so we return
            return {"IPlistV4": IPlistV4, "IPlistV6": IPlistV6}
        if (insideAnswerSection) and  (answerLine.search(line)):
            (FQDN, TTL, typeOfRecord, Record) = answerLine.search(line).groups()
            if typeOfRecord == "A":
                IPlistV4.append(Record)
            if typeOfRecord == "AAAA":
                IPlistV6.append(Record)
    return {"IPlistV4": IPlistV4, "IPlistV6": IPlistV6}